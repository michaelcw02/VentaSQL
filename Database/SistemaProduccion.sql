
connect system/manager as sysdba

DROP USER test CASCADE;
CREATE USER test IDENTIFIED BY test;
GRANT DBA TO test;

connect test/test



CREATE TABLE PRODUCTOS_TERMINADOS (
    CODIGO INT,
    CANTIDAD INT,
    CONSTRAINT PK_PRODUCTOS_TERMINADOS PRIMARY KEY (CODIGO)
);

CREATE TABLE PRODUCCION_PEDIDOS (
    CODIGO_CLIENTE VARCHAR(25),
    CODIGO_PRODUCTO INT,
    CANTIDAD INT,
    FECHA DATE
);
 
CREATE OR REPLACE FUNCTION F_INSERT_PP (CC VARCHAR, CP INT, CANT INT, FECHA DATE)
RETURN INTEGER AS STATE INTEGER;
BEGIN 
    INSERT INTO PRODUCCION_PEDIDOS VALUES (CC, CP, CANT, FECHA);
    STATE := 1;
    RETURN STATE;
    EXCEPTION 
        WHEN OTHERS THEN
            RETURN 0;
END;
/
 
CREATE OR REPLACE PROCEDURE P1_PP (CC VARCHAR, CP INT, CANT INT) IS
OK INTEGER;
BEGIN
    OK := F_INSERT_PP (CC, CP, CANT, SYSDATE);
    IF OK = 1 THEN
        COMMIT;
    ELSE
        ROLLBACK;
    END IF;
END;
/
 
CREATE OR REPLACE FUNCTION F_INSERT_PT(xcodigo int,xcantidad int)
RETURN INTEGER
IS
BEGIN
INSERT INTO PRODUCTOS_TERMINADOS VALUES (xcodigo,xcantidad);
EXCEPTION
    WHEN VALUE_ERROR THEN
        RETURN 0;
    WHEN OTHERS THEN
        RETURN 0;
RETURN 1;
END;

CREATE OR REPLACE PROCEDURE P1_PT(xcodigo int,xcantidad int)
IS
OK INTEGER;
BEGIN
	OK := F_INSERT_PT(xcodigo,xcantidad);
    IF OK = 0 THEN
        ROLLBACK;
    ELSE
        COMMIT;
    END IF;
END;
/

